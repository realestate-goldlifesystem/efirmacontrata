<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>E-FirmaContrata • Estado de envío</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Branding global -->
  <link rel="stylesheet" href="theme.css" />

  <!-- (Opcional) estilos mínimos específicos de página -->
  <style>
    .page-wrap{
      min-height:100vh; display:flex; align-items:center; justify-content:center; padding:20px;
      background: radial-gradient(1200px 600px at 50% -20%, rgba(255,215,0,.08), transparent 60%) , var(--black-primary);
    }
    .status-card { width:min(720px, 95vw); }
    .status-icon{ font-size:56px; line-height:1; }
    .status-title{ font-size: var(--fs-h1); margin-top:8px; }
    .status-desc{ color: var(--gray-400); margin-top:8px }
    .actions{ display:flex; gap:12px; flex-wrap:wrap; margin-top:22px }
    .divider{ height:1px; background:rgba(255,215,0,.18); margin:18px 0 }
    .details{ display:none; }
    .details.show{ display:block; }
    .footer-note{ font-size: var(--fs-small); color: var(--gray-400); margin-top: 10px }
  </style>
</head>
<body>
  <main class="page-wrap">
    <section class="card status-card">
      <header class="card-header">
        <div class="badge">E-FirmaContrata</div>
        <h1 class="status-title">Estado del envío</h1>
      </header>

      <div class="card-body">
        <div id="statusBlock" class="grid" style="grid-template-columns: 72px 1fr;">
          <div id="statusIcon" class="status-icon" aria-hidden="true">✨</div>
          <div>
            <h2 id="statusTitle">Procesando...</h2>
            <p id="statusDesc" class="status-desc">Estamos validando tu información.</p>
          </div>
        </div>

        <div class="divider"></div>

        <div class="actions">
          <a class="btn btn-primary btn-pill" href="selector.html">Volver al selector</a>
          <button id="btnVerDetalles" class="btn btn-secondary btn-pill" type="button">Ver detalles</button>
          <button id="btnCopiarMsg" class="btn btn-ghost btn-pill" type="button">Copiar mensaje</button>
        </div>

        <div id="details" class="details">
          <div class="banner" id="bannerInfo" style="margin-top:18px;">
            <strong>Detalles técnicos:</strong>
            <div id="detailText" class="muted" style="margin-top:8px;">—</div>
          </div>
        </div>

        <p class="footer-note">
          Real Estate – Gold Life System • © <span id="year"></span>
        </p>
      </div>
    </section>
  </main>

  <!-- Config global -->
  <script src="config.js"></script>

  <script>
    (function init(){
      const qs = new URLSearchParams(location.search);
      const status = (qs.get('status') || 'success').toLowerCase(); // success | used | error
      const extraMsg = qs.get('msg') ? decodeURIComponent(qs.get('msg')) : '';

      const icon = document.getElementById('statusIcon');
      const title = document.getElementById('statusTitle');
      const desc = document.getElementById('statusDesc');
      const details = document.getElementById('details');
      const detailText = document.getElementById('detailText');
      const yearEl = document.getElementById('year');
      yearEl.textContent = new Date().getFullYear();

      // Acciones
      document.getElementById('btnVerDetalles').addEventListener('click', () => {
        details.classList.toggle('show');
      });

      document.getElementById('btnCopiarMsg').addEventListener('click', async () => {
        const text = `[E-FirmaContrata] Estado: ${title.textContent} — ${desc.textContent}`;
        try { await navigator.clipboard.writeText(text); } catch(e){}
      });

      // Render según estado
      const views = {
        success: () => {
          icon.textContent = '✅';
          title.textContent = 'Envío exitoso';
          desc.textContent = 'Recibimos tu información. Te notificaremos por correo cuando finalice la validación.';
          document.querySelector('.badge').classList.add('badge-success');
          detailText.textContent = extraMsg || 'El envío fue recibido correctamente por el servidor.';
        },
        used: () => {
          icon.textContent = '⚠️';
          title.textContent = 'Enlace ya utilizado';
          desc.textContent = 'Este enlace ya fue usado previamente. Si necesitas actualizar documentos, solicita un nuevo enlace de corrección.';
          document.querySelector('.badge').classList.add('badge-warning');
          detailText.textContent = extraMsg || 'El CDR o token aparece como consumido en la base.';
        },
        error: () => {
          icon.textContent = '❌';
          title.textContent = 'Ocurrió un error';
          desc.textContent = 'No pudimos procesar tu envío. Inténtalo nuevamente o contáctanos por soporte.';
          document.querySelector('.badge').classList.add('badge-danger');
          detailText.textContent = extraMsg || 'El servidor devolvió un estado inválido o se produjo un fallo de red.';
        }
      };

      (views[status] || views.success)();

      // Micro interacción: brillo sutil del icono
      icon.style.transition = 'transform .3s var(--ease-soft)';
      icon.addEventListener('mouseenter', () => icon.style.transform = 'scale(1.06)');
      icon.addEventListener('mouseleave', () => icon.style.transform = 'scale(1)');

      // Seguridad mínima: no exponer URL sensibles en detalles
      if (detailText.textContent && /https?:\/\//i.test(detailText.textContent)) {
        detailText.textContent = 'Detalle oculto por seguridad.';
      }
    })();
  </script>
</body>
</html>
