<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SARLAFT Persona Natural - E-firmaContrata</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="styles/responsive.css">
    <link rel="stylesheet" href="styles/forms.css">
    <link rel="stylesheet" href="styles/components.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üèõÔ∏è</div>
            <h1>SARLAFT - Persona Natural</h1>
            <p>Sistema de Administraci√≥n del Riesgo de Lavado de Activos y Financiaci√≥n del Terrorismo</p>
        </div>

        <div class="content">
            <!-- Alert informativo -->
            <div class="alert alert-info">
                <div class="alert-icon">‚ÑπÔ∏è</div>
                <div class="alert-content">
                    <div class="alert-title">Importante</div>
                    <div class="alert-message">
                        Este formulario es requerido por ley para prevenir el lavado de activos y financiaci√≥n del terrorismo. 
                        Toda la informaci√≥n ser√° tratada de manera confidencial seg√∫n la normativa vigente.
                    </div>
                </div>
            </div>

            <form id="sarlaftForm" class="form-container">
                <!-- Secci√≥n 1: Informaci√≥n Personal -->
                <div class="form-section">
                    <h3>üë§ Informaci√≥n Personal</h3>
                    
                    <div class="form-field show">
                        <div class="form-row">
                            <div>
                                <label>Tipo de Documento <span class="required">*</span></label>
                                <select id="tipoDocumento" required>
                                    <option value="">Seleccione...</option>
                                    <option value="CC">C√©dula de Ciudadan√≠a</option>
                                    <option value="CE">C√©dula de Extranjer√≠a</option>
                                    <option value="PA">Pasaporte</option>
                                    <option value="TI">Tarjeta de Identidad</option>
                                </select>
                            </div>
                            <div>
                                <label>N√∫mero de Documento <span class="required">*</span></label>
                                <input type="text" id="numeroDocumento" placeholder="N√∫mero de documento" required>
                            </div>
                        </div>
                    </div>

                    <div class="form-field show">
                        <div class="form-row">
                            <div>
                                <label>Lugar de Expedici√≥n <span class="required">*</span></label>
                                <input type="text" id="lugarExpedicion" placeholder="Ciudad/Departamento" required>
                            </div>
                            <div>
                                <label>Fecha de Expedici√≥n <span class="required">*</span></label>
                                <input type="date" id="fechaExpedicion" required>
                            </div>
                        </div>
                    </div>

                    <div class="form-field show">
                        <div class="form-row">
                            <div>
                                <label>Primer Nombre <span class="required">*</span></label>
                                <input type="text" id="primerNombre" placeholder="Primer nombre" data-type="name" required>
                            </div>
                            <div>
                                <label>Segundo Nombre</label>
                                <input type="text" id="segundoNombre" placeholder="Segundo nombre" data-type="name">
                            </div>
                        </div>
                    </div>

                    <div class="form-field show">
                        <div class="form-row">
                            <div>
                                <label>Primer Apellido <span class="required">*</span></label>
                                <input type="text" id="primerApellido" placeholder="Primer apellido" data-type="name" required>
                            </div>
                            <div>
                                <label>Segundo Apellido</label>
                                <input type="text" id="segundoApellido" placeholder="Segundo apellido" data-type="name">
                            </div>
                        </div>
                    </div>

                    <div class="form-field show">
                        <div class="form-row">
                            <div>
                                <label>Fecha de Nacimiento <span class="required">*</span></label>
                                <input type="date" id="fechaNacimiento" required>
                            </div>
                            <div>
                                <label>Lugar de Nacimiento <span class="required">*</span></label>
                                <input type="text" id="lugarNacimiento" placeholder="Ciudad/Pa√≠s" required>
                            </div>
                        </div>
                    </div>

                    <div class="form-field show">
                        <div class="form-row">
                            <div>
                                <label>Nacionalidad <span class="required">*</span></label>
                                <select id="nacionalidad" required>
                                    <option value="">Seleccione...</option>
                                    <option value="Colombiana">Colombiana</option>
                                    <option value="Venezolana">Venezolana</option>
                                    <option value="Ecuatoriana">Ecuatoriana</option>
                                    <option value="Peruana">Peruana</option>
                                    <option value="Argentina">Argentina</option>
                                    <option value="Brasile√±a">Brasile√±a</option>
                                    <option value="Estadounidense">Estadounidense</option>
                                    <option value="Espa√±ola">Espa√±ola</option>
                                    <option value="Otra">Otra</option>
                                </select>
                            </div>
                            <div>
                                <label>G√©nero <span class="required">*</span></label>
                                <select id="genero" required>
                                    <option value="">Seleccione...</option>
                                    <option value="M">Masculino</option>
                                    <option value="F">Femenino</option>
                                    <option value="O">Otro</option>
                                    <option value="P">Prefiero no decir</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Secci√≥n 2: Informaci√≥n de Contacto -->
                <div class="form-section">
                    <h3>üìû Informaci√≥n de Contacto</h3>
                    
                    <div class="form-field show">
                        <label>Direcci√≥n de Residencia <span class="required">*</span></label>
                        <input type="text" id="direccionResidencia" placeholder="Direcci√≥n completa" required>
                    </div>

                    <div class="form-field show">
                        <div class="form-row">
                            <div>
                                <label>Ciudad <span class="required">*</span></label>
                                <input type="text" id="ciudad" placeholder="Ciudad" required>
                            </div>
                            <div>
                                <label>Departamento <span class="required">*</span></label>
                                <input type="text" id="departamento" placeholder="Departamento" required>
                            </div>
                        </div>
                    </div>

                    <div class="form-field show">
                        <div class="form-row">
                            <div>
                                <label>Tel√©fono Fijo</label>
                                <input type="tel" id="telefonoFijo" placeholder="601234567">
                            </div>
                            <div>
                                <label>Tel√©fono Celular <span class="required">*</span></label>
                                <input type="tel" id="telefonoCelular" placeholder="3001234567" onblur="validarTelefono(this)" required>
                            </div>
                        </div>
                    </div>

                    <div class="form-field show">
                        <label>Correo Electr√≥nico <span class="required">*</span></label>
                        <input type="email" id="correoElectronico" placeholder="correo@ejemplo.com" onblur="validarEmail(this)" required>
                    </div>
                </div>

                <!-- Secci√≥n 3: Informaci√≥n Econ√≥mica -->
                <div class="form-section">
                    <h3>üí∞ Informaci√≥n Econ√≥mica</h3>
                    
                    <div class="form-field show">
                        <div class="form-row">
                            <div>
                                <label>Ocupaci√≥n/Profesi√≥n <span class="required">*</span></label>
                                <input type="text" id="ocupacion" placeholder="Profesi√≥n u ocupaci√≥n principal" required>
                            </div>
                            <div>
                                <label>Sector Econ√≥mico <span class="required">*</span></label>
                                <select id="sectorEconomico" required>
                                    <option value="">Seleccione...</option>
                                    <option value="Agricultura">Agricultura, ganader√≠a, caza y silvicultura</option>
                                    <option value="Mineria">Explotaci√≥n de minas y canteras</option>
                                    <option value="Manufactura">Industrias manufactureras</option>
                                    <option value="Construccion">Construcci√≥n</option>
                                    <option value="Comercio">Comercio al por mayor y al por menor</option>
                                    <option value="Transporte">Transporte, almacenamiento y comunicaciones</option>
                                    <option value="Financiero">Intermediaci√≥n financiera</option>
                                    <option value="Inmobiliario">Actividades inmobiliarias</option>
                                    <option value="Servicios">Servicios comunales, sociales y personales</option>
                                    <option value="Educacion">Educaci√≥n</option>
                                    <option value="Salud">Servicios sociales y de salud</option>
                                    <option value="Gobierno">Administraci√≥n p√∫blica</option>
                                    <option value="Otro">Otro</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-field show">
                        <div class="form-row">
                            <div>
                                <label>Ingresos Mensuales <span class="required">*</span></label>
                                <select id="ingresosMensuales" required>
                                    <option value="">Seleccione...</option>
                                    <option value="0-1">Menos de 1 SMMLV</option>
                                    <option value="1-2">Entre 1 y 2 SMMLV</option>
                                    <option value="2-4">Entre 2 y 4 SMMLV</option>
                                    <option value="4-6">Entre 4 y 6 SMMLV</option>
                                    <option value="6-10">Entre 6 y 10 SMMLV</option>
                                    <option value="10-20">Entre 10 y 20 SMMLV</option>
                                    <option value="20+">M√°s de 20 SMMLV</option>
                                </select>
                            </div>
                            <div>
                                <label>Patrimonio <span class="required">*</span></label>
                                <select id="patrimonio" required>
                                    <option value="">Seleccione...</option>
                                    <option value="0-50">Menos de 50 SMMLV</option>
                                    <option value="50-100">Entre 50 y 100 SMMLV</option>
                                    <option value="100-200">Entre 100 y 200 SMMLV</option>
                                    <option value="200-500">Entre 200 y 500 SMMLV</option>
                                    <option value="500-1000">Entre 500 y 1.000 SMMLV</option>
                                    <option value="1000+">M√°s de 1.000 SMMLV</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-field show">
                        <label>Empresa donde Labora</label>
                        <input type="text" id="empresaLabora" placeholder="Nombre de la empresa">
                    </div>

                    <div class="form-field show">
                        <div class="form-row">
                            <div>
                                <label>Direcci√≥n de la Empresa</label>
                                <input type="text" id="direccionEmpresa" placeholder="Direcci√≥n completa">
                            </div>
                            <div>
                                <label>Tel√©fono de la Empresa</label>
                                <input type="tel" id="telefonoEmpresa" placeholder="601234567">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Secci√≥n 4: Informaci√≥n de Riesgo -->
                <div class="form-section">
                    <h3>‚ö†Ô∏è Evaluaci√≥n de Riesgo</h3>
                    
                    <div class="form-field show">
                        <label>¬øEs usted una Persona Pol√≠ticamente Expuesta (PEP)? <span class="required">*</span></label>
                        <div class="decision-buttons">
                            <button type="button" class="decision-btn" onclick="setPEP(true)">S√ç</button>
                            <button type="button" class="decision-btn" onclick="setPEP(false)">NO</button>
                        </div>
                        <div class="form-help">
                            Personas que ejercen funciones p√∫blicas prominentes o han ejercido en el √∫ltimo a√±o
                        </div>
                    </div>

                    <div class="form-field" id="pepDetails" style="display: none;">
                        <label>Especifique el cargo o funci√≥n <span class="required">*</span></label>
                        <textarea id="cargoFuncion" placeholder="Describa el cargo o funci√≥n p√∫blica" rows="3"></textarea>
                    </div>

                    <div class="form-field show">
                        <label>¬øTiene familiares o v√≠nculos con Personas Pol√≠ticamente Expuestas? <span class="required">*</span></label>
                        <div class="decision-buttons">
                            <button type="button" class="decision-btn" onclick="setVinculoPEP(true)">S√ç</button>
                            <button type="button" class="decision-btn" onclick="setVinculoPEP(false)">NO</button>
                        </div>
                    </div>

                    <div class="form-field" id="vinculoPepDetails" style="display: none;">
                        <label>Especifique el parentesco y cargo <span class="required">*</span></label>
                        <textarea id="parentescoPEP" placeholder="Describa el parentesco y cargo de la persona" rows="3"></textarea>
                    </div>

                    <div class="form-field show">
                        <label>¬øRealiza operaciones en moneda extranjera? <span class="required">*</span></label>
                        <div class="decision-buttons">
                            <button type="button" class="decision-btn" onclick="setMonedaExtranjera(true)">S√ç</button>
                            <button type="button" class="decision-btn" onclick="setMonedaExtranjera(false)">NO</button>
                        </div>
                    </div>

                    <div class="form-field" id="monedaExtranjeraDetails" style="display: none;">
                        <div class="form-row">
                            <div>
                                <label>Tipo de moneda <span class="required">*</span></label>
                                <select id="tipoMoneda">
                                    <option value="">Seleccione...</option>
                                    <option value="USD">D√≥lares Americanos (USD)</option>
                                    <option value="EUR">Euros (EUR)</option>
                                    <option value="GBP">Libras Esterlinas (GBP)</option>
                                    <option value="Otra">Otra</option>
                                </select>
                            </div>
                            <div>
                                <label>Monto mensual aproximado <span class="required">*</span></label>
                                <input type="text" id="montoMonedaExtranjera" placeholder="Monto en moneda extranjera">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Secci√≥n 5: Referencias -->
                <div class="form-section">
                    <h3>üë• Referencias</h3>
                    
                    <h4>Referencia Personal</h4>
                    <div class="form-field show">
                        <div class="form-row">
                            <div>
                                <label>Nombre Completo <span class="required">*</span></label>
                                <input type="text" id="nombreReferenciaPersonal" placeholder="Nombre completo" data-type="name" required>
                            </div>
                            <div>
                                <label>Tel√©fono <span class="required">*</span></label>
                                <input type="tel" id="telefonoReferenciaPersonal" placeholder="3001234567" required>
                            </div>
                        </div>
                    </div>

                    <h4>Referencia Comercial/Laboral</h4>
                    <div class="form-field show">
                        <div class="form-row">
                            <div>
                                <label>Nombre Completo <span class="required">*</span></label>
                                <input type="text" id="nombreReferenciaComercial" placeholder="Nombre completo" data-type="name" required>
                            </div>
                            <div>
                                <label>Tel√©fono <span class="required">*</span></label>
                                <input type="tel" id="telefonoReferenciaComercial" placeholder="3001234567" required>
                            </div>
                        </div>
                    </div>

                    <div class="form-field show">
                        <label>Empresa/Entidad</label>
                        <input type="text" id="empresaReferenciaComercial" placeholder="Nombre de la empresa">
                    </div>
                </div>

                <!-- Secci√≥n 6: Declaraci√≥n -->
                <div class="form-section">
                    <h3>üìã Declaraci√≥n</h3>
                    
                    <div class="form-field show">
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="declaracionVeracidad" required>
                            <label for="declaracionVeracidad">
                                <strong>Declaro que la informaci√≥n suministrada es veraz y completa.</strong> 
                                Me comprometo a actualizar esta informaci√≥n cuando se presenten cambios 
                                y autorizo la verificaci√≥n de la misma.
                            </label>
                        </div>
                    </div>

                    <div class="form-field show">
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="autorizacionDatos" required>
                            <label for="autorizacionDatos">
                                <strong>Autorizo el tratamiento de mis datos personales</strong> conforme a la 
                                Ley 1581 de 2012 y dem√°s normas aplicables, para los fines relacionados 
                                con la prevenci√≥n del lavado de activos y financiaci√≥n del terrorismo.
                            </label>
                        </div>
                    </div>

                    <div class="form-field show">
                        <div class="form-row">
                            <div>
                                <label>Lugar <span class="required">*</span></label>
                                <input type="text" id="lugarDeclaracion" placeholder="Ciudad" required>
                            </div>
                            <div>
                                <label>Fecha <span class="required">*</span></label>
                                <input type="date" id="fechaDeclaracion" required>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Botones -->
                <div class="form-navigation">
                    <button type="button" class="btn btn-secondary" onclick="window.history.back()">
                        ‚Üê Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        ‚úì Enviar Formulario SARLAFT
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <h3>Procesando formulario SARLAFT...</h3>
        <p id="loadingMsg">Por favor espere</p>
    </div>

    <!-- Debug Banner -->
    <div id="debugBanner" class="debug-banner" style="display:none;">DEBUG ACTIVO</div>

    <!-- Scripts -->
    <script src="config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/validations.js"></script>
    <script src="js/api.js"></script>

    <script>
        // ==========================================
        // ESTADO DEL FORMULARIO SARLAFT
        // ==========================================
        const sarlaftState = {
            codigoRegistro: '',
            esPEP: null,
            tieneVinculoPEP: null,
            realizaOperacionesMonedaExtranjera: null
        };

        // ==========================================
        // INICIALIZACI√ìN
        // ==========================================
        window.onload = function() {
            initializeSarlaft();
            if (CONFIG.DEBUG) {
                document.getElementById('debugBanner').style.display = 'block';
                document.body.classList.add('debug');
            }
        };

        function initializeSarlaft() {
            const urlParams = new URLSearchParams(window.location.search);
            sarlaftState.codigoRegistro = urlParams.get('cdr') || '';
            
            if (!sarlaftState.codigoRegistro) {
                mostrarMensaje('C√≥digo de registro no v√°lido', 'error');
                setTimeout(() => window.location.href = 'selector.html', 2500);
                return;
            }

            // Establecer fecha actual
            document.getElementById('fechaDeclaracion').value = new Date().toISOString().split('T')[0];
            
            mostrarMensaje(`C√≥digo de registro: ${sarlaftState.codigoRegistro}`, 'success');
        }

        // ==========================================
        // FUNCIONES DE ESTADO
        // ==========================================
        function setPEP(esPEP) {
            sarlaftState.esPEP = esPEP;
            
            // Actualizar UI
            event.target.parentElement.querySelectorAll('.decision-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            // Mostrar/ocultar detalles
            const pepDetails = document.getElementById('pepDetails');
            if (esPEP) {
                pepDetails.style.display = 'block';
                pepDetails.classList.add('show');
                document.getElementById('cargoFuncion').required = true;
            } else {
                pepDetails.style.display = 'none';
                pepDetails.classList.remove('show');
                document.getElementById('cargoFuncion').required = false;
                document.getElementById('cargoFuncion').value = '';
            }
        }

        function setVinculoPEP(tieneVinculo) {
            sarlaftState.tieneVinculoPEP = tieneVinculo;
            
            // Actualizar UI
            event.target.parentElement.querySelectorAll('.decision-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            // Mostrar/ocultar detalles
            const vinculoDetails = document.getElementById('vinculoPepDetails');
            if (tieneVinculo) {
                vinculoDetails.style.display = 'block';
                vinculoDetails.classList.add('show');
                document.getElementById('parentescoPEP').required = true;
            } else {
                vinculoDetails.style.display = 'none';
                vinculoDetails.classList.remove('show');
                document.getElementById('parentescoPEP').required = false;
                document.getElementById('parentescoPEP').value = '';
            }
        }

        function setMonedaExtranjera(realizaOperaciones) {
            sarlaftState.realizaOperacionesMonedaExtranjera = realizaOperaciones;
            
            // Actualizar UI
            event.target.parentElement.querySelectorAll('.decision-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            // Mostrar/ocultar detalles
            const monedaDetails = document.getElementById('monedaExtranjeraDetails');
            if (realizaOperaciones) {
                monedaDetails.style.display = 'block';
                monedaDetails.classList.add('show');
                document.getElementById('tipoMoneda').required = true;
                document.getElementById('montoMonedaExtranjera').required = true;
            } else {
                monedaDetails.style.display = 'none';
                monedaDetails.classList.remove('show');
                document.getElementById('tipoMoneda').required = false;
                document.getElementById('montoMonedaExtranjera').required = false;
                document.getElementById('tipoMoneda').value = '';
                document.getElementById('montoMonedaExtranjera').value = '';
            }
        }

        // ==========================================
        // VALIDACI√ìN Y ENV√çO
        // ==========================================
        document.getElementById('sarlaftForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!validateForm()) {
                return;
            }
            
            await submitSarlaftForm();
        });

        function validateForm() {
            // Validaciones b√°sicas ya se manejan con HTML5 required
            
            // Validar PEP
            if (sarlaftState.esPEP === null) {
                mostrarMensaje('Debe indicar si es una Persona Pol√≠ticamente Expuesta', 'error');
                return false;
            }
            
            if (sarlaftState.tieneVinculoPEP === null) {
                mostrarMensaje('Debe indicar si tiene v√≠nculos con Personas Pol√≠ticamente Expuestas', 'error');
                return false;
            }
            
            if (sarlaftState.realizaOperacionesMonedaExtranjera === null) {
                mostrarMensaje('Debe indicar si realiza operaciones en moneda extranjera', 'error');
                return false;
            }
            
            return true;
        }

        async function submitSarlaftForm() {
            const formData = obtenerDatosFormulario('sarlaftForm');
            
            // Agregar datos del estado
            formData.esPEP = sarlaftState.esPEP;
            formData.tieneVinculoPEP = sarlaftState.tieneVinculoPEP;
            formData.realizaOperacionesMonedaExtranjera = sarlaftState.realizaOperacionesMonedaExtranjera;
            formData.codigoRegistro = sarlaftState.codigoRegistro;
            formData.tipoPersona = 'natural';
            
            try {
                mostrarOverlay(true, 'Enviando formulario SARLAFT...');
                
                const resultado = await realizarLlamadaAPI({
                    accion: 'procesarFormularioSARLAFT',
                    datosFormulario: formData
                });
                
                if (resultado.success) {
                    mostrarOverlay(true, 'Formulario enviado exitosamente. Redirigiendo...');
                    setTimeout(() => {
                        redirigirCon('pagina-exito.html', {
                            estado: 'exitoso',
                            cdr: sarlaftState.codigoRegistro,
                            tipo: 'sarlaft-natural'
                        });
                    }, 1500);
                } else {
                    mostrarMensaje('Error enviando el formulario. Intente nuevamente.', 'error');
                }
                
            } catch (error) {
                console.error('Error enviando formulario SARLAFT:', error);
                mostrarMensaje('Error de conexi√≥n. Intente nuevamente.', 'error');
            } finally {
                mostrarOverlay(false);
            }
        }

        // ==========================================
        // INICIALIZACI√ìN DE CAMPOS
        // ==========================================
        // Auto-completar lugar si hay geolocalizaci√≥n
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                // En una implementaci√≥n real, usar√≠amos un servicio de geocodificaci√≥n
                // Por ahora, establecemos Bogot√° como valor por defecto
                if (!document.getElementById('lugarDeclaracion').value) {
                    document.getElementById('lugarDeclaracion').value = 'Bogot√° D.C.';
                }
            }, function() {
                // Si falla la geolocalizaci√≥n, establecer Bogot√° por defecto
                if (!document.getElementById('lugarDeclaracion').value) {
                    document.getElementById('lugarDeclaracion').value = 'Bogot√° D.C.';
                }
            });
        }
    </script>
</body>
</html>