<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autorizaci√≥n Tratamiento de Datos - E-firmaContrata</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="styles/responsive.css">
    <link rel="stylesheet" href="styles/forms.css">
    <link rel="stylesheet" href="styles/components.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üîí</div>
            <h1>Autorizaci√≥n Tratamiento de Datos Personales</h1>
            <p>Conforme a la Ley 1581 de 2012 y Decreto 1377 de 2013</p>
        </div>

        <div class="content">
            <!-- Alert informativo -->
            <div class="alert alert-info">
                <div class="alert-icon">üõ°Ô∏è</div>
                <div class="alert-content">
                    <div class="alert-title">Protecci√≥n de Datos Personales</div>
                    <div class="alert-message">
                        Su privacidad es importante para nosotros. Este formulario cumple con las normativas 
                        vigentes para la protecci√≥n de datos personales en Colombia.
                    </div>
                </div>
            </div>

            <form id="autorizacionForm" class="form-container">
                <!-- Secci√≥n 1: Informaci√≥n del Titular -->
                <div class="form-section">
                    <h3>üë§ Informaci√≥n del Titular de los Datos</h3>
                    
                    <div class="form-field show">
                        <div class="form-row">
                            <div>
                                <label>Tipo de Documento <span class="required">*</span></label>
                                <select id="tipoDocumento" required>
                                    <option value="">Seleccione...</option>
                                    <option value="CC">C√©dula de Ciudadan√≠a</option>
                                    <option value="CE">C√©dula de Extranjer√≠a</option>
                                    <option value="PA">Pasaporte</option>
                                    <option value="TI">Tarjeta de Identidad</option>
                                </select>
                            </div>
                            <div>
                                <label>N√∫mero de Documento <span class="required">*</span></label>
                                <input type="text" id="numeroDocumento" placeholder="N√∫mero de documento" required>
                            </div>
                        </div>
                    </div>

                    <div class="form-field show">
                        <div class="form-row">
                            <div>
                                <label>Nombres Completos <span class="required">*</span></label>
                                <input type="text" id="nombres" placeholder="Nombres completos" data-type="name" required>
                            </div>
                            <div>
                                <label>Apellidos Completos <span class="required">*</span></label>
                                <input type="text" id="apellidos" placeholder="Apellidos completos" data-type="name" required>
                            </div>
                        </div>
                    </div>

                    <div class="form-field show">
                        <div class="form-row">
                            <div>
                                <label>Correo Electr√≥nico <span class="required">*</span></label>
                                <input type="email" id="email" placeholder="correo@ejemplo.com" onblur="validarEmail(this)" required>
                            </div>
                            <div>
                                <label>Tel√©fono Celular <span class="required">*</span></label>
                                <input type="tel" id="celular" placeholder="3001234567" onblur="validarTelefono(this)" required>
                            </div>
                        </div>
                    </div>

                    <div class="form-field show">
                        <label>Direcci√≥n</label>
                        <input type="text" id="direccion" placeholder="Direcci√≥n completa">
                    </div>
                </div>

                <!-- Secci√≥n 2: Pol√≠tica de Tratamiento de Datos -->
                <div class="form-section">
                    <h3>üìã Pol√≠tica de Tratamiento de Datos Personales</h3>
                    
                    <div class="card">
                        <div class="card-header">
                            <h4 class="card-title">Responsable del Tratamiento</h4>
                        </div>
                        <div class="card-body">
                            <p><strong>Real Estate Gold Life System</strong></p>
                            <p><strong>NIT:</strong> [N√∫mero de identificaci√≥n]</p>
                            <p><strong>Direcci√≥n:</strong> [Direcci√≥n de la empresa]</p>
                            <p><strong>Email:</strong> datos@goldlifesystem.com</p>
                            <p><strong>Tel√©fono:</strong> [Tel√©fono de contacto]</p>
                        </div>
                    </div>

                    <div class="card mt-3">
                        <div class="card-header">
                            <h4 class="card-title">Finalidad del Tratamiento</h4>
                        </div>
                        <div class="card-body">
                            <p>Sus datos personales ser√°n utilizados para las siguientes finalidades:</p>
                            <ul>
                                <li>Gestionar y ejecutar contratos de arrendamiento</li>
                                <li>Realizar verificaciones de identidad y solvencia crediticia</li>
                                <li>Cumplir con obligaciones legales y normativas</li>
                                <li>Prevenir lavado de activos y financiaci√≥n del terrorismo (SARLAFT)</li>
                                <li>Comunicaciones relacionadas con el servicio</li>
                                <li>Archivo y conservaci√≥n de documentos contractuales</li>
                                <li>Gesti√≥n de cobranza y administraci√≥n de cartera</li>
                                <li>Mejoramiento del servicio y desarrollo de nuevos productos</li>
                            </ul>
                        </div>
                    </div>

                    <div class="card mt-3">
                        <div class="card-header">
                            <h4 class="card-title">Tipos de Datos Recopilados</h4>
                        </div>
                        <div class="card-body">
                            <ul>
                                <li><strong>Datos de identificaci√≥n:</strong> Nombre, apellidos, documento de identidad, fecha y lugar de nacimiento</li>
                                <li><strong>Datos de contacto:</strong> Direcci√≥n, tel√©fono, correo electr√≥nico</li>
                                <li><strong>Datos laborales:</strong> Ocupaci√≥n, ingresos, informaci√≥n de empleador</li>
                                <li><strong>Datos financieros:</strong> Informaci√≥n crediticia, ingresos, patrimonio</li>
                                <li><strong>Datos familiares:</strong> Informaci√≥n de codeudores y referencias</li>
                                <li><strong>Documentos:</strong> Copias de documentos de identidad, comprobantes de ingresos</li>
                                <li><strong>Datos biom√©tricos:</strong> Cuando aplique, im√°genes y firmas</li>
                            </ul>
                        </div>
                    </div>

                    <div class="card mt-3">
                        <div class="card-header">
                            <h4 class="card-title">Sus Derechos como Titular</h4>
                        </div>
                        <div class="card-body">
                            <p>Como titular de los datos, usted tiene derecho a:</p>
                            <ul>
                                <li><strong>Conocer, actualizar y rectificar</strong> sus datos personales</li>
                                <li><strong>Solicitar prueba</strong> de la autorizaci√≥n otorgada</li>
                                <li><strong>Ser informado</strong> sobre el uso que se ha dado a sus datos</li>
                                <li><strong>Presentar quejas</strong> ante la Superintendencia de Industria y Comercio</li>
                                <li><strong>Revocar la autorizaci√≥n</strong> y/o solicitar la supresi√≥n del dato</li>
                                <li><strong>Acceder de forma gratuita</strong> a sus datos personales tratados</li>
                            </ul>
                            
                            <p class="mt-3"><strong>Para ejercer estos derechos, puede contactarnos a:</strong></p>
                            <p>üìß Email: datos@goldlifesystem.com<br>
                               üìû Tel√©fono: [N√∫mero de atenci√≥n]<br>
                               üè¢ Oficina: [Direcci√≥n f√≠sica]</p>
                        </div>
                    </div>
                </div>

                <!-- Secci√≥n 3: Autorizaci√≥n Espec√≠fica -->
                <div class="form-section">
                    <h3>‚úÖ Autorizaci√≥n Espec√≠fica</h3>
                    
                    <div class="form-field show">
                        <h4>Seleccione las autorizaciones que otorga:</h4>
                        
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="autorizacionBasica" required>
                            <label for="autorizacionBasica">
                                <strong>Autorizaci√≥n B√°sica (Obligatoria):</strong> 
                                Autorizo el tratamiento de mis datos personales para las finalidades 
                                relacionadas con la gesti√≥n del contrato de arrendamiento y cumplimiento 
                                de obligaciones legales.
                            </label>
                        </div>

                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="autorizacionMarketing">
                            <label for="autorizacionMarketing">
                                <strong>Marketing y Promociones (Opcional):</strong> 
                                Autorizo el env√≠o de informaci√≥n comercial, promocional y publicitaria 
                                sobre productos y servicios relacionados.
                            </label>
                        </div>

                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="autorizacionTerceros">
                            <label for="autorizacionTerceros">
                                <strong>Compartir con Terceros (Opcional):</strong> 
                                Autorizo compartir mis datos con terceros aliados para ofrecerme 
                                productos y servicios complementarios (seguros, servicios financieros, etc.).
                            </label>
                        </div>

                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="autorizacionCredito" required>
                            <label for="autorizacionCredito">
                                <strong>Consulta Centrales de Riesgo (Obligatoria):</strong> 
                                Autorizo la consulta de mi informaci√≥n en centrales de riesgo crediticio 
                                y bases de datos financieras para evaluaci√≥n de solvencia.
                            </label>
                        </div>

                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="autorizacionBiometricos">
                            <label for="autorizacionBiometricos">
                                <strong>Datos Biom√©tricos (Opcional):</strong> 
                                Autorizo el tratamiento de datos biom√©tricos como firmas digitales, 
                                fotograf√≠as y otros identificadores √∫nicos.
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Secci√≥n 4: Transferencia Internacional -->
                <div class="form-section">
                    <h3>üåê Transferencia Internacional de Datos</h3>
                    
                    <div class="alert alert-warning">
                        <div class="alert-icon">‚ö†Ô∏è</div>
                        <div class="alert-content">
                            <div class="alert-title">Transferencia a Terceros Pa√≠ses</div>
                            <div class="alert-message">
                                Algunos de nuestros proveedores de servicios pueden estar ubicados en otros pa√≠ses. 
                                Sus datos podr√≠an ser transferidos a pa√≠ses con niveles de protecci√≥n diferentes.
                            </div>
                        </div>
                    </div>

                    <div class="form-field show">
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="autorizacionTransferencia">
                            <label for="autorizacionTransferencia">
                                <strong>Autorizo la transferencia internacional</strong> de mis datos personales 
                                a terceros pa√≠ses, cuando sea necesario para la prestaci√≥n del servicio, 
                                garantizando que se mantengan los niveles de protecci√≥n adecuados.
                            </label>
                        </div>
                    </div>

                    <div class="form-field show">
                        <label>Pa√≠ses autorizados para transferencia:</label>
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="paisUSA">
                            <label for="paisUSA">Estados Unidos (servicios de almacenamiento en la nube)</label>
                        </div>
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="paisEU">
                            <label for="paisEU">Uni√≥n Europea (procesamiento de datos)</label>
                        </div>
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="paisOtros">
                            <label for="paisOtros">Otros pa√≠ses con niveles adecuados de protecci√≥n</label>
                        </div>
                    </div>
                </div>

                <!-- Secci√≥n 5: Tiempo de Conservaci√≥n -->
                <div class="form-section">
                    <h3>‚è∞ Tiempo de Conservaci√≥n</h3>
                    
                    <div class="card">
                        <div class="card-body">
                            <p>Sus datos personales ser√°n conservados durante los siguientes per√≠odos:</p>
                            <ul>
                                <li><strong>Datos contractuales:</strong> Durante la vigencia del contrato y 10 a√±os adicionales</li>
                                <li><strong>Datos financieros:</strong> 5 a√±os despu√©s de finalizada la relaci√≥n comercial</li>
                                <li><strong>Datos SARLAFT:</strong> 20 a√±os conforme a la normativa de prevenci√≥n de lavado de activos</li>
                                <li><strong>Datos de marketing:</strong> Hasta que revoque la autorizaci√≥n</li>
                                <li><strong>Datos de contacto:</strong> 2 a√±os despu√©s de finalizada la relaci√≥n comercial</li>
                            </ul>
                            
                            <p class="mt-3">
                                <strong>Nota:</strong> Algunos datos pueden conservarse por per√≠odos adicionales 
                                cuando sea requerido por obligaciones legales o para el ejercicio de acciones judiciales.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Secci√≥n 6: Revocaci√≥n -->
                <div class="form-section">
                    <h3>üö´ Procedimiento de Revocaci√≥n</h3>
                    
                    <div class="card">
                        <div class="card-body">
                            <p><strong>¬øC√≥mo revocar esta autorizaci√≥n?</strong></p>
                            <ol>
                                <li>Env√≠e una solicitud por escrito a: datos@goldlifesystem.com</li>
                                <li>Indique claramente qu√© autorizaciones desea revocar</li>
                                <li>Adjunte copia de su documento de identidad</li>
                                <li>Especifique los datos que desea sean suprimidos</li>
                            </ol>
                            
                            <p class="mt-3">
                                <strong>Importante:</strong> La revocaci√≥n no proceder√° cuando:
                            </p>
                            <ul>
                                <li>Exista un deber legal o contractual de conservar los datos</li>
                                <li>Los datos sean necesarios para el cumplimiento de obligaciones</li>
                                <li>Se requieran para el ejercicio de acciones judiciales</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Secci√≥n 7: Declaraci√≥n Final -->
                <div class="form-section">
                    <h3>üìù Declaraci√≥n y Aceptaci√≥n</h3>
                    
                    <div class="form-field show">
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="declaracionEntendimiento" required>
                            <label for="declaracionEntendimiento">
                                <strong>Declaro que he le√≠do y entendido</strong> completamente la pol√≠tica de 
                                tratamiento de datos personales y las implicaciones de la autorizaci√≥n que otorgo.
                            </label>
                        </div>
                    </div>

                    <div class="form-field show">
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="declaracionVoluntaria" required>
                            <label for="declaracionVoluntaria">
                                <strong>Declaro que esta autorizaci√≥n es otorgada de manera libre, 
                                voluntaria, previa e informada</strong>, conociendo las consecuencias 
                                de la misma.
                            </label>
                        </div>
                    </div>

                    <div class="form-field show">
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="declaracionDerechos" required>
                            <label for="declaracionDerechos">
                                <strong>Reconozco que conozco mis derechos</strong> como titular de datos 
                                personales y los mecanismos dispuestos para ejercerlos.
                            </label>
                        </div>
                    </div>

                    <div class="form-field show">
                        <div class="form-row">
                            <div>
                                <label>Lugar de Autorizaci√≥n <span class="required">*</span></label>
                                <input type="text" id="lugarAutorizacion" placeholder="Ciudad" required>
                            </div>
                            <div>
                                <label>Fecha de Autorizaci√≥n <span class="required">*</span></label>
                                <input type="date" id="fechaAutorizacion" required>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Botones -->
                <div class="form-navigation">
                    <button type="button" class="btn btn-secondary" onclick="window.history.back()">
                        ‚Üê Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        ‚úì Otorgar Autorizaci√≥n
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <h3>Procesando autorizaci√≥n...</h3>
        <p id="loadingMsg">Por favor espere</p>
    </div>

    <!-- Debug Banner -->
    <div id="debugBanner" class="debug-banner" style="display:none;">DEBUG ACTIVO</div>

    <!-- Scripts -->
    <script src="config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/validations.js"></script>
    <script src="js/api.js"></script>

    <script>
        // ==========================================
        // ESTADO DE LA AUTORIZACI√ìN
        // ==========================================
        const autorizacionState = {
            codigoRegistro: '',
            autorizaciones: {}
        };

        // ==========================================
        // INICIALIZACI√ìN
        // ==========================================
        window.onload = function() {
            initializeAutorizacion();
            if (CONFIG.DEBUG) {
                document.getElementById('debugBanner').style.display = 'block';
                document.body.classList.add('debug');
            }
        };

        function initializeAutorizacion() {
            const urlParams = new URLSearchParams(window.location.search);
            autorizacionState.codigoRegistro = urlParams.get('cdr') || '';
            
            if (!autorizacionState.codigoRegistro) {
                mostrarMensaje('C√≥digo de registro no v√°lido', 'error');
                setTimeout(() => window.location.href = 'selector.html', 2500);
                return;
            }

            // Establecer fecha y lugar actual
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('fechaAutorizacion').value = today;
            
            // Intentar obtener la ubicaci√≥n
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        // En una implementaci√≥n real, usar√≠amos geocodificaci√≥n
                        document.getElementById('lugarAutorizacion').value = 'Bogot√° D.C.';
                    },
                    function() {
                        document.getElementById('lugarAutorizacion').value = 'Bogot√° D.C.';
                    }
                );
            } else {
                document.getElementById('lugarAutorizacion').value = 'Bogot√° D.C.';
            }
            
            mostrarMensaje(`C√≥digo de registro: ${autorizacionState.codigoRegistro}`, 'success');
        }

        // ==========================================
        // VALIDACI√ìN Y ENV√çO
        // ==========================================
        document.getElementById('autorizacionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!validateForm()) {
                return;
            }
            
            await submitAutorizacionForm();
        });

        function validateForm() {
            // Verificar autorizaciones obligatorias
            const autorizacionBasica = document.getElementById('autorizacionBasica');
            const autorizacionCredito = document.getElementById('autorizacionCredito');
            
            if (!autorizacionBasica.checked) {
                mostrarMensaje('Debe otorgar la autorizaci√≥n b√°sica para continuar', 'error');
                return false;
            }
            
            if (!autorizacionCredito.checked) {
                mostrarMensaje('Debe autorizar la consulta en centrales de riesgo', 'error');
                return false;
            }
            
            // Verificar declaraciones obligatorias
            const declaraciones = ['declaracionEntendimiento', 'declaracionVoluntaria', 'declaracionDerechos'];
            for (const declaracion of declaraciones) {
                if (!document.getElementById(declaracion).checked) {
                    mostrarMensaje('Debe aceptar todas las declaraciones obligatorias', 'error');
                    return false;
                }
            }
            
            return true;
        }

        async function submitAutorizacionForm() {
            const formData = obtenerDatosFormulario('autorizacionForm');
            
            // Recopilar autorizaciones espec√≠ficas
            formData.autorizaciones = {
                basica: document.getElementById('autorizacionBasica').checked,
                marketing: document.getElementById('autorizacionMarketing').checked,
                terceros: document.getElementById('autorizacionTerceros').checked,
                credito: document.getElementById('autorizacionCredito').checked,
                biometricos: document.getElementById('autorizacionBiometricos').checked,
                transferencia: document.getElementById('autorizacionTransferencia').checked
            };
            
            // Pa√≠ses autorizados para transferencia
            formData.paisesAutorizados = {
                usa: document.getElementById('paisUSA').checked,
                eu: document.getElementById('paisEU').checked,
                otros: document.getElementById('paisOtros').checked
            };
            
            formData.codigoRegistro = autorizacionState.codigoRegistro;
            formData.fechaProceso = new Date().toISOString();
            
            try {
                mostrarOverlay(true, 'Registrando autorizaci√≥n...');
                
                const resultado = await realizarLlamadaAPI({
                    accion: 'procesarAutorizacionDatos',
                    datosFormulario: formData
                });
                
                if (resultado.success) {
                    mostrarOverlay(true, 'Autorizaci√≥n registrada exitosamente. Redirigiendo...');
                    setTimeout(() => {
                        redirigirCon('pagina-exito.html', {
                            estado: 'exitoso',
                            cdr: autorizacionState.codigoRegistro,
                            tipo: 'autorizacion-datos'
                        });
                    }, 1500);
                } else {
                    mostrarMensaje('Error registrando la autorizaci√≥n. Intente nuevamente.', 'error');
                }
                
            } catch (error) {
                console.error('Error enviando autorizaci√≥n:', error);
                mostrarMensaje('Error de conexi√≥n. Intente nuevamente.', 'error');
            } finally {
                mostrarOverlay(false);
            }
        }

        // ==========================================
        // FUNCIONES AUXILIARES
        // ==========================================
        function imprimirAutorizacion() {
            window.print();
        }

        function descargarPDF() {
            // En una implementaci√≥n real, se generar√≠a un PDF
            mostrarMensaje('Funcionalidad de descarga en desarrollo', 'info');
        }
    </script>
</body>
</html>