<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EFirmaContrata - Sistema Premium de Gesti√≥n Documental</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --gold-primary: #FFD700;
            --gold-dark: #B8860B;
            --gold-light: #FFF8DC;
            --black-primary: #0F0F0F;
            --black-secondary: #1A1A1A;
            --gray-dark: #2D2D2D;
            --gray-medium: #404040;
            --white: #FFFFFF;
            --success: #059669;
            --error: #DC2626;
            --info: #2563EB;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--black-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Part√≠culas doradas de fondo */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 1;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--gold-primary);
            border-radius: 50%;
            opacity: 0;
            animation: floatUp 15s infinite;
            box-shadow: 0 0 6px var(--gold-primary);
        }

        @keyframes floatUp {
            0% {
                opacity: 0;
                transform: translateY(100vh) scale(0);
            }
            10% {
                opacity: 1;
                transform: translateY(90vh) scale(1);
            }
            90% {
                opacity: 1;
                transform: translateY(10vh) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(0) scale(0);
            }
        }

        /* Contenedor principal */
        .main-container {
            position: relative;
            z-index: 10;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        /* Card principal */
        .form-card {
            width: 100%;
            max-width: 900px;
            background: linear-gradient(135deg, var(--black-secondary) 0%, var(--gray-dark) 100%);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 
                0 0 50px rgba(255, 215, 0, 0.1),
                0 0 100px rgba(255, 215, 0, 0.05),
                inset 0 0 2px rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        /* Header del formulario con shimmer */
        .form-header {
            background: linear-gradient(135deg, var(--gold-dark) 0%, var(--gold-primary) 100%);
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .form-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent,
                rgba(255, 255, 255, 0.3),
                transparent
            );
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%) translateY(-100%) rotate(45deg);
            }
            100% {
                transform: translateX(100%) translateY(100%) rotate(45deg);
            }
        }

        .logo {
            font-size: 36px;
            font-weight: bold;
            color: var(--black-primary);
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 1;
            letter-spacing: 2px;
        }

        .tagline {
            color: var(--black-secondary);
            font-size: 14px;
            position: relative;
            z-index: 1;
            font-weight: 500;
        }

        /* Pantalla inicial con dos botones */
        .initial-screen {
            padding: 60px 40px;
            text-align: center;
            display: block;
        }

        .initial-screen.hidden {
            display: none;
        }

        .initial-title {
            color: var(--gold-primary);
            font-size: 28px;
            margin-bottom: 20px;
        }

        .initial-description {
            color: var(--white);
            margin-bottom: 40px;
            line-height: 1.6;
        }

        .initial-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .initial-btn {
            flex: 1;
            min-width: 250px;
            padding: 20px;
            background: var(--black-primary);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .initial-btn:hover {
            border-color: var(--gold-primary);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.2);
        }

        .initial-btn-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .initial-btn-title {
            color: var(--gold-primary);
            font-size: 20px;
            margin-bottom: 10px;
        }

        .initial-btn-desc {
            color: var(--gray-medium);
            font-size: 14px;
        }

        /* Progress bar DIN√ÅMICO */
        .progress-container {
            padding: 30px;
            background: var(--gray-dark);
            border-bottom: 1px solid rgba(255, 215, 0, 0.1);
            display: none;
        }

        .progress-container.show {
            display: block;
        }

        .progress-bar {
            display: flex;
            justify-content: space-between;
            position: relative;
        }

        .progress-line {
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--gray-medium);
            z-index: 1;
        }

        .progress-line-active {
            position: absolute;
            top: 20px;
            left: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--gold-dark), var(--gold-primary));
            z-index: 2;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px var(--gold-primary);
        }

        .step {
            position: relative;
            z-index: 3;
            text-align: center;
            flex: 1;
        }

        .step-circle {
            width: 40px;
            height: 40px;
            margin: 0 auto 10px;
            border-radius: 50%;
            background: var(--gray-medium);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-dark);
            font-weight: bold;
            transition: all 0.3s ease;
            border: 2px solid var(--gray-medium);
        }

        .step.active .step-circle {
            background: var(--gold-primary);
            color: var(--black-primary);
            border-color: var(--gold-primary);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            animation: pulse 2s infinite;
        }

        .step.completed .step-circle {
            background: var(--success);
            color: var(--white);
            border-color: var(--success);
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }

        .step-label {
            font-size: 12px;
            color: var(--gray-medium);
            transition: color 0.3s ease;
        }

        .step.active .step-label,
        .step.completed .step-label {
            color: var(--gold-primary);
        }

        /* Contenido del formulario */
        .form-content {
            padding: 40px;
            min-height: 400px;
            display: none;
        }

        .form-content.show {
            display: block;
        }

        .form-step {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .form-step.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .step-title {
            color: var(--gold-primary);
            font-size: 24px;
            margin-bottom: 30px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 215, 0, 0.2);
        }

        /* Campos din√°micos */
        .form-field {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
            margin-bottom: 25px;
        }

        .form-field.show {
            opacity: 1;
            transform: translateY(0);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        label {
            display: block;
            color: var(--gold-light);
            font-size: 14px;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .required {
            color: var(--gold-primary);
        }

        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="date"],
        select {
            width: 100%;
            padding: 12px 15px;
            background: var(--black-primary);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 8px;
            color: var(--white);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: var(--gold-primary);
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.1);
        }

        input::placeholder {
            color: var(--gray-medium);
        }

        /* Validaci√≥n visual */
        input.valid {
            border-color: var(--success);
        }

        input.invalid {
            border-color: var(--error);
        }

        .validation-message {
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }

        .validation-message.show {
            display: block;
        }

        .validation-message.error {
            color: var(--error);
        }

        .validation-message.success {
            color: var(--success);
        }

        /* File upload estilizado */
        .file-upload-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }

        .file-upload-label {
            display: block;
            padding: 12px 15px;
            background: linear-gradient(135deg, var(--gray-dark) 0%, var(--black-primary) 100%);
            border: 2px dashed rgba(255, 215, 0, 0.3);
            border-radius: 8px;
            color: var(--gold-light);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload-label:hover {
            border-color: var(--gold-primary);
            background: linear-gradient(135deg, var(--black-primary) 0%, var(--gray-dark) 100%);
        }

        .file-upload-input {
            position: absolute;
            left: -9999px;
        }

        .file-selected {
            background: rgba(255, 215, 0, 0.1);
            border-color: var(--gold-primary);
        }

        .file-size-info {
            font-size: 11px;
            color: var(--gray-medium);
            margin-top: 5px;
        }

        /* Botones para decisiones */
        .decision-question {
            text-align: center;
            padding: 40px 0;
            transition: opacity 0.3s ease;
        }

        .decision-question.disabled {
            opacity: 0.3;
            pointer-events: none;
        }

        .decision-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 30px;
        }

        .decision-btn {
            padding: 15px 40px;
            background: var(--black-primary);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            color: var(--white);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            font-weight: 600;
        }

        .decision-btn:hover:not(:disabled) {
            border-color: var(--gold-primary);
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.2);
        }

        .decision-btn.selected {
            background: var(--gold-primary);
            color: var(--black-primary);
            border-color: var(--gold-primary);
        }

        .decision-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Navegaci√≥n */
        .form-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 30px 40px;
            background: var(--gray-dark);
            border-top: 1px solid rgba(255, 215, 0, 0.1);
            display: none;
        }

        .form-navigation.show {
            display: flex;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-prev {
            background: var(--gray-medium);
            color: var(--white);
        }

        .btn-prev:hover {
            background: var(--gray-dark);
            transform: translateX(-5px);
        }

        .btn-next,
        .btn-submit {
            background: linear-gradient(135deg, var(--gold-dark) 0%, var(--gold-primary) 100%);
            color: var(--black-primary);
            position: relative;
            overflow: hidden;
        }

        .btn-next::before,
        .btn-submit::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }

        .btn-next:hover::before,
        .btn-submit:hover::before {
            left: 100%;
        }

        .btn-next:hover,
        .btn-submit:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Modales y resto de estilos sin cambios... */
        /* [CONTIN√öA EN PARTE 2] */
    </style>
</head>
<body>
    <!-- Part√≠culas de fondo -->
    <div class="particles" id="particles"></div>

    <!-- Contenedor principal -->
    <div class="main-container">
        <div class="form-card">
            <!-- Header -->
            <div class="form-header">
                <div class="logo">EFirmaContrata</div>
                <div class="tagline">Gesti√≥n de Documentaci√≥n Real Estate - GoldLife System</div>
            </div>
            <!-- Pantalla inicial -->
            <div class="initial-screen" id="initialScreen">
                <h2 class="initial-title">Bienvenido al Sistema de Registro</h2>
                <p class="initial-description">
                    Para continuar con el proceso de arrendamiento, primero debe realizar el pago de los derechos de contrato y luego proceder con el registro de sus documentos.
                </p>
                
                <div class="initial-buttons">
                    <div class="initial-btn" onclick="mostrarModalPago()">
                        <div class="initial-btn-icon">üí≥</div>
                        <div class="initial-btn-title">Pagar Derechos</div>
                        <div class="initial-btn-desc">Realice el pago de $60.000 COP</div>
                    </div>
                    
                    <div class="initial-btn" onclick="iniciarRegistro()">
                        <div class="initial-btn-icon">üìã</div>
                        <div class="initial-btn-title">Registrarse</div>
                        <div class="initial-btn-desc">Complete el formulario de registro</div>
                    </div>
                </div>
            </div>

            <!-- Progress Bar DIN√ÅMICO (se ajustar√° seg√∫n los pasos) -->
            <div class="progress-container" id="progressContainer">
                <div class="progress-bar" id="progressBar">
                    <!-- Los pasos se generar√°n din√°micamente -->
                </div>
            </div>

            <!-- Contenido del formulario -->
            <div class="form-content" id="formContent">
                <!-- Paso 1: Documentos Iniciales -->
                <div class="form-step active" data-step="1">
                    <h2 class="step-title">Documentos Iniciales</h2>
                    
                    <div class="form-field" id="field1">
                        <label>Documento Estudio Aprobado <span class="required">*</span></label>
                        <div class="file-upload-wrapper">
                            <label class="file-upload-label" for="estudioAprobado" id="labelEstudioAprobado">
                                Seleccionar archivo
                            </label>
                            <input type="file" id="estudioAprobado" class="file-upload-input" accept="image/*,.pdf" required onchange="handleFileSelect(this, 'field2')">
                        </div>
                        <div class="file-size-info">M√°ximo 10MB - Formatos: JPG, PNG, PDF</div>
                    </div>
                    
                    <div class="form-field" id="field2">
                        <label>Comprobante de Pago <span class="required">*</span></label>
                        <div class="file-upload-wrapper">
                            <label class="file-upload-label" for="comprobantePago" id="labelComprobantePago">
                                Seleccionar archivo
                            </label>
                            <input type="file" id="comprobantePago" class="file-upload-input" accept="image/*,.pdf" required onchange="handleFileSelect(this, null)">
                        </div>
                        <div class="file-size-info">M√°ximo 10MB - Formatos: JPG, PNG, PDF</div>
                    </div>
                </div>

                <!-- Paso 2: Informaci√≥n Personal -->
                <div class="form-step" data-step="2">
                    <h2 class="step-title">Informaci√≥n Personal del Inquilino</h2>
                    
                    <div class="form-field" id="field3">
                        <div class="form-row">
                            <div>
                                <label>Tipo de Documento <span class="required">*</span></label>
                                <select id="tipoDocumento" required onchange="showNextField('field4')">
                                    <option value="">Seleccione...</option>
                                    <option value="CC">C√©dula de Ciudadan√≠a</option>
                                    <option value="CE">C√©dula de Extranjer√≠a</option>
                                    <option value="PA">Pasaporte</option>
                                    <option value="NIT">NIT</option>
                                </select>
                            </div>
                            
                            <div>
                                <label>N√∫mero de Documento <span class="required">*</span></label>
                                <input type="text" id="numeroDocumento" placeholder="Ej: 1234567890" required onblur="showNextField('field4')">
                                <div class="validation-message" id="numeroDocumentoError"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-field" id="field4">
                        <div class="form-row">
                            <div>
                                <label>Confirmar N√∫mero de Documento <span class="required">*</span></label>
                                <input type="text" id="confirmarDocumento" placeholder="Confirme el n√∫mero" required onblur="validateAndShow('numeroDocumento', 'confirmarDocumento', 'field5')">
                                <div class="validation-message" id="confirmarDocumentoError"></div>
                            </div>
                            
                            <div>
                                <label>Fecha de Expedici√≥n</label>
                                <input type="date" id="fechaExpedicion">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-field" id="field5">
                        <div class="form-row">
                            <div>
                                <label>Nombres Completos <span class="required">*</span></label>
                                <input type="text" id="nombres" placeholder="Ej: Juan Carlos" required onblur="showNextField('field6')">
                                <div class="validation-message" id="nombresError"></div>
                            </div>
                            
                            <div>
                                <label>Apellidos Completos <span class="required">*</span></label>
                                <input type="text" id="apellidos" placeholder="Ej: Garc√≠a L√≥pez" required onblur="showNextField('field6')">
                                <div class="validation-message" id="apellidosError"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-field" id="field6">
                        <div class="form-row">
                            <div>
                                <label>Correo Electr√≥nico <span class="required">*</span></label>
                                <input type="email" id="email" placeholder="correo@ejemplo.com" required onblur="validarEmail(this); showNextField('field7')">
                                <div class="validation-message" id="emailError"></div>
                            </div>
                            
                            <div>
                                <label>Confirmar Correo <span class="required">*</span></label>
                                <input type="email" id="confirmarEmail" placeholder="Confirme el correo" required onblur="validateAndShow('email', 'confirmarEmail', 'field7')">
                                <div class="validation-message" id="confirmarEmailError"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-field" id="field7">
                        <div class="form-row">
                            <div>
                                <label>Celular <span class="required">*</span></label>
                                <input type="tel" id="celular" placeholder="Ej: 3001234567" required onblur="validarTelefono(this); showNextField('field8')">
                                <div class="validation-message" id="celularError"></div>
                            </div>
                            
                            <div>
                                <label>Confirmar Celular <span class="required">*</span></label>
                                <input type="tel" id="confirmarCelular" placeholder="Confirme el celular" required onblur="validateAndShow('celular', 'confirmarCelular', 'field8')">
                                <div class="validation-message" id="confirmarCelularError"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-field" id="field8">
                        <label>Ocupaci√≥n/Profesi√≥n <span class="required">*</span></label>
                        <input type="text" id="ocupacion" placeholder="Ej: Ingeniero, Comerciante, etc." required>
                        <div class="validation-message" id="ocupacionError"></div>
                    </div>
                </div>

                <!-- Paso 3: Identidad del Inquilino (SIN EXPANSI√ìN) -->
                <div class="form-step" data-step="3">
                    <h2 class="step-title">Identidad del Inquilino</h2>
                    
                    <!-- Primera secci√≥n: Tipo de documento -->
                    <div class="form-field show">
                        <div style="text-align: center; margin-bottom: 30px;">
                            <h3 style="color: var(--gold-primary); margin-bottom: 20px;">¬øEl archivo tiene ambas caras del documento?</h3>
                            <div class="decision-buttons">
                                <button type="button" class="decision-btn" onclick="setDocumentType(true)">S√≠</button>
                                <button type="button" class="decision-btn" onclick="setDocumentType(false)">NO</button>
                            </div>
                        </div>
                        
                        <!-- √Årea de carga √∫nica (se muestra seg√∫n selecci√≥n) -->
                        <div id="singleDocUpload" style="display: none; opacity: 0; transition: opacity 0.5s ease;">
                            <label>Documento de Identidad (Ambas caras en un archivo) <span class="required">*</span></label>
                            <div class="file-upload-wrapper">
                                <label class="file-upload-label" for="docIdentidadCompleto" id="labelDocIdentidadCompleto">
                                    Seleccionar archivo con ambas caras
                                </label>
                                <input type="file" id="docIdentidadCompleto" class="file-upload-input" accept="image/*,.pdf" onchange="handleDocumentUpload(this, 'completo')">
                            </div>
                            <div class="file-size-info">M√°ximo 10MB - Formatos: JPG, PNG, PDF</div>
                        </div>
                        
                        <!-- √Årea de carga doble (se muestra seg√∫n selecci√≥n) -->
                        <div id="doubleDocUpload" style="display: none; opacity: 0; transition: opacity 0.5s ease;">
                            <div style="margin-bottom: 20px;">
                                <label>Cara frontal del documento <span class="required">*</span></label>
                                <div class="file-upload-wrapper">
                                    <label class="file-upload-label" for="docIdentidadFrente" id="labelDocIdentidadFrente">
                                        Seleccionar cara frontal
                                    </label>
                                    <input type="file" id="docIdentidadFrente" class="file-upload-input" accept="image/*,.pdf" onchange="handleDocumentUpload(this, 'frente')">
                                </div>
                            </div>
                            
                            <div>
                                <label>Cara posterior del documento <span class="required">*</span></label>
                                <div class="file-upload-wrapper">
                                    <label class="file-upload-label" for="docIdentidadReverso" id="labelDocIdentidadReverso">
                                        Seleccionar cara posterior
                                    </label>
                                    <input type="file" id="docIdentidadReverso" class="file-upload-input" accept="image/*,.pdf" onchange="handleDocumentUpload(this, 'reverso')">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Segunda secci√≥n: Codeudores (SOLO PREGUNTA, NO EXPANSI√ìN) -->
                    <div class="decision-question disabled" id="codeudorQuestion">
                        <h3 style="color: var(--gold-primary); margin-bottom: 20px;">¬øTiene codeudores?</h3>
                        <div class="decision-buttons">
                            <button class="decision-btn" id="btnCodeudorNo" onclick="setCodeudor(false)" disabled>NO</button>
                            <button class="decision-btn" id="btnCodeudorSi" onclick="setCodeudor(true)" disabled>S√≠</button>
                        </div>
                    </div>
                </div>

                <!-- Pasos de Codeudores (P√ÅGINAS INDEPENDIENTES) -->
                <!-- Codeudor 1 -->
                <div class="form-step" data-step="codeudor-1" id="stepCodeudor1" style="display: none;">
                    <h2 class="step-title">Identidad del Codeudor 1</h2>
                    <div id="codeudor1Fields"></div>
                    
                    <div class="decision-question">
                        <h3 style="color: var(--gold-primary); margin-bottom: 20px;">¬øHay m√°s codeudores?</h3>
                        <div class="decision-buttons">
                            <button class="decision-btn" id="btnMoreCodeudor1No" onclick="addMoreCodeudor(false, 1)">NO</button>
                            <button class="decision-btn" id="btnMoreCodeudor1Si" onclick="addMoreCodeudor(true, 1)">S√≠</button>
                        </div>
                    </div>
                </div>

                <!-- Codeudor 2 -->
                <div class="form-step" data-step="codeudor-2" id="stepCodeudor2" style="display: none;">
                    <h2 class="step-title">Identidad del Codeudor 2</h2>
                    <div id="codeudor2Fields"></div>
                    
                    <div class="decision-question">
                        <h3 style="color: var(--gold-primary); margin-bottom: 20px;">¬øHay m√°s codeudores?</h3>
                        <div class="decision-buttons">
                            <button class="decision-btn" id="btnMoreCodeudor2No" onclick="addMoreCodeudor(false, 2)">NO</button>
                            <button class="decision-btn" id="btnMoreCodeudor2Si" onclick="addMoreCodeudor(true, 2)">S√≠</button>
                        </div>
                    </div>
                </div>

                <!-- Codeudor 3 -->
                <div class="form-step" data-step="codeudor-3" id="stepCodeudor3" style="display: none;">
                    <h2 class="step-title">Identidad del Codeudor 3</h2>
                    <div id="codeudor3Fields"></div>
                    
                    <div class="decision-question">
                        <h3 style="color: var(--gold-primary); margin-bottom: 20px;">M√°ximo de codeudores alcanzado</h3>
                    </div>
                </div>

                <!-- √öltimo Paso: Revisi√≥n Final (SIEMPRE AL FINAL) -->
                <div class="form-step" data-step="confirmacion" id="stepConfirmacion" style="display: none;">
                    <h2 class="step-title">Revisi√≥n Final</h2>
                    
                    <div style="text-align: center; padding: 40px 0;">
                        <h3 style="color: var(--gold-primary); margin: 20px 0;">‚ú® Todo listo para enviar</h3>
                        
                        <p style="color: var(--white); margin-bottom: 30px;">
                            Revise que toda la informaci√≥n est√© correcta antes de continuar.
                            Si necesita hacer cambios, use el bot√≥n "Anterior".
                        </p>
                        
                        <button class="btn btn-submit" onclick="mostrarConfirmacion()" style="margin: 20px auto;">
                            üìù Ver Resumen y Confirmar
                        </button>
                    </div>
                </div>
            </div>

            <!-- Navegaci√≥n -->
            <div class="form-navigation" id="formNavigation">
                <button type="button" class="btn btn-prev" id="btnPrev" onclick="previousStep()" style="display: none;">
                    Anterior
                </button>
                
                <div style="flex: 1;"></div>
                
                <button type="button" class="btn btn-next" id="btnNext" onclick="nextStep()">
                    Siguiente
                </button>
            </div>
        </div>
    </div>

    <!-- Modales (sin cambios) -->
    <!-- Modal de Pago -->
    <div id="modalPago" class="modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);z-index:1000;align-items:center;justify-content:center;">
        <!-- Contenido del modal sin cambios... -->
    </div>

    <!-- Modal de Confirmaci√≥n -->
    <div id="confirmationModal" class="confirmation-modal" style="display:none;">
        <!-- Contenido del modal sin cambios... -->
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <!-- Contenido sin cambios... -->
    </div>

    <script src="config.js"></script>
    <script>
        // ==========================================
        // ESTADO GLOBAL DEL WIZARD
        // ==========================================
        
        const state = {
            currentStep: 1,
            totalSteps: 4, // Din√°mico
            codigoRegistro: '',
            archivosBase64: {},
            
            // Control de decisiones
            hasCodeudores: null,
            numCodeudores: 0,
            documentoCompletoRequerido: null,
            documentosIdentidadCargados: false,
            
            // Pasos din√°micos del wizard
            steps: [
                { id: 'documentos', label: 'Documentos', number: 1 },
                { id: 'informacion', label: 'Informaci√≥n', number: 2 },
                { id: 'identidad', label: 'Identidad', number: 3 },
                { id: 'confirmacion', label: 'Confirmaci√≥n', number: 4 }
            ],
            
            // Control de limpieza
            codeudorDataSaved: {},
            maxFileSize: 10 * 1024 * 1024
        };

        // ==========================================
        // INICIALIZACI√ìN
        // ==========================================
        
        window.onload = function() {
            initializeApp();
        };

        function initializeApp() {
            // Obtener c√≥digo de registro
            const urlParams = new URLSearchParams(window.location.search);
            state.codigoRegistro = urlParams.get('cdr') || '';
            
            if (!state.codigoRegistro || !validarCodigoRegistro(state.codigoRegistro)) {
                alert('C√≥digo de registro no v√°lido');
                window.location.href = 'selector.html';
                return;
            }
            
            // Inicializar componentes
            createParticles();
            setupSlider();
            setupValidationListeners();
            
            console.info(`üöÄ Sistema Wizard inicializado - CDR: ${state.codigoRegistro}`);
        }

        // ==========================================
        // GESTI√ìN DE PASOS DIN√ÅMICOS
        // ==========================================
        
        function actualizarPasosDinamicos() {
            // Resetear pasos
            state.steps = [
                { id: 'documentos', label: 'Documentos', number: 1 },
                { id: 'informacion', label: 'Informaci√≥n', number: 2 },
                { id: 'identidad', label: 'Identidad', number: 3 }
            ];
            
            let stepNumber = 4;
            
            // Agregar codeudores si existen
            for (let i = 1; i <= state.numCodeudores; i++) {
                state.steps.push({
                    id: `codeudor-${i}`,
                    label: `Codeudor ${i}`,
                    number: stepNumber++
                });
            }
            
            // Siempre agregar confirmaci√≥n al final
            state.steps.push({
                id: 'confirmacion',
                label: 'Confirmaci√≥n',
                number: stepNumber
            });
            
            state.totalSteps = stepNumber;
            
            // Actualizar barra de progreso
            renderProgressBar();
        }

        function renderProgressBar() {
            const progressBar = document.getElementById('progressBar');
            if (!progressBar) return;
            
            let html = `
                <div class="progress-line"></div>
                <div class="progress-line-active" id="progressLineActive" style="width: 0%"></div>
            `;
            
            state.steps.forEach((step, index) => {
                const isActive = (index + 1) === state.currentStep;
                const isCompleted = (index + 1) < state.currentStep;
                
                html += `
                    <div class="step ${isActive ? 'active' : ''} ${isCompleted ? 'completed' : ''}" 
                         id="step-${step.id}">
                        <div class="step-circle">
                            ${isCompleted ? '‚úì' : step.number}
                        </div>
                        <div class="step-label">${step.label}</div>
                    </div>
                `;
            });
            
            progressBar.innerHTML = html;
            updateProgressBar();
        }

        function updateProgressBar() {
            const progress = ((state.currentStep - 1) / (state.totalSteps - 1)) * 100;
            const progressLine = document.getElementById('progressLineActive');
            if (progressLine) {
                progressLine.style.width = progress + '%';
            }
        }
        // ==========================================
        // NAVEGACI√ìN DEL WIZARD
        // ==========================================
        
        function nextStep() {
            if (!validateCurrentStep()) {
                return;
            }
            
            // Obtener paso actual
            const currentStepData = state.steps[state.currentStep - 1];
            
            // Si estamos en identidad y se seleccion√≥ codeudores, preparar los campos
            if (currentStepData.id === 'identidad' && state.hasCodeudores && state.numCodeudores === 1) {
                // Crear campos del primer codeudor solo cuando navegamos a √©l
                setTimeout(() => createCodeudorFields(1), 100);
            }
            
            // Si estamos en un codeudor y se agregar√° otro
            if (currentStepData.id.includes('codeudor-')) {
                const codeudorNum = parseInt(currentStepData.id.split('-')[1]);
                if (state.numCodeudores > codeudorNum) {
                    setTimeout(() => createCodeudorFields(codeudorNum + 1), 100);
                }
            }
            
            // Ocultar paso actual
            hideCurrentStep();
            
            // Avanzar
            state.currentStep++;
            
            // Mostrar nuevo paso
            showCurrentStep();
            
            // Actualizar UI
            updateNavigationButtons();
            updateProgressBar();
        }

        function previousStep() {
            if (state.currentStep <= 1) return;
            
            // Ocultar paso actual
            hideCurrentStep();
            
            // Retroceder
            state.currentStep--;
            
            // Mostrar paso anterior
            showCurrentStep();
            
            // Actualizar UI
            updateNavigationButtons();
            updateProgressBar();
        }

        function hideCurrentStep() {
            const currentStepData = state.steps[state.currentStep - 1];
            const stepElement = getStepElement(currentStepData.id);
            if (stepElement) {
                stepElement.classList.remove('active');
            }
        }

        function showCurrentStep() {
            const currentStepData = state.steps[state.currentStep - 1];
            const stepElement = getStepElement(currentStepData.id);
            if (stepElement) {
                stepElement.classList.add('active');
                
                // Animaciones especiales para algunos pasos
                if (currentStepData.id === 'informacion') {
                    setTimeout(() => {
                        document.getElementById('field3')?.classList.add('show');
                    }, 100);
                }
            }
        }

        function getStepElement(stepId) {
            // Mapear IDs a elementos del DOM
            const mapping = {
                'documentos': document.querySelector('[data-step="1"]'),
                'informacion': document.querySelector('[data-step="2"]'),
                'identidad': document.querySelector('[data-step="3"]'),
                'codeudor-1': document.getElementById('stepCodeudor1'),
                'codeudor-2': document.getElementById('stepCodeudor2'),
                'codeudor-3': document.getElementById('stepCodeudor3'),
                'confirmacion': document.getElementById('stepConfirmacion')
            };
            
            return mapping[stepId];
        }

        function updateNavigationButtons() {
            const btnPrev = document.getElementById('btnPrev');
            const btnNext = document.getElementById('btnNext');
            
            // Mostrar/ocultar bot√≥n anterior
            btnPrev.style.display = state.currentStep === 1 ? 'none' : 'block';
            
            // Ocultar bot√≥n siguiente en confirmaci√≥n
            const currentStepData = state.steps[state.currentStep - 1];
            btnNext.style.display = currentStepData.id === 'confirmacion' ? 'none' : 'block';
        }

        // ==========================================
        // MANEJO DE DECISIONES (SIN EXPANSI√ìN)
        // ==========================================
        
        function setDocumentType(isComplete) {
            state.documentoCompletoRequerido = isComplete;
            
            // Marcar bot√≥n seleccionado
            event.target.classList.add('selected');
            event.target.parentElement.querySelectorAll('.decision-btn').forEach(btn => {
                if (btn !== event.target) btn.classList.remove('selected');
            });
            
            // Mostrar √°rea de carga correspondiente
            if (isComplete) {
                document.getElementById('singleDocUpload').style.display = 'block';
                document.getElementById('doubleDocUpload').style.display = 'none';
                setTimeout(() => {
                    document.getElementById('singleDocUpload').style.opacity = '1';
                }, 100);
            } else {
                document.getElementById('singleDocUpload').style.display = 'none';
                document.getElementById('doubleDocUpload').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('doubleDocUpload').style.opacity = '1';
                }, 100);
            }
        }

        function setCodeudor(hasCod) {
            const previousDecision = state.hasCodeudores;
            
            // Si cambia de S√ç a NO, limpiar todos los codeudores
            if (previousDecision === true && hasCod === false) {
                limpiarTodosCodeudores();
            }
            
            state.hasCodeudores = hasCod;
            
            // Marcar bot√≥n seleccionado
            event.target.classList.add('selected');
            event.target.parentElement.querySelectorAll('.decision-btn').forEach(btn => {
                if (btn !== event.target) btn.classList.remove('selected');
            });
            
            if (hasCod) {
                // Preparar para codeudores (NO crear campos a√∫n)
                state.numCodeudores = 1;
            } else {
                // Sin codeudores
                state.numCodeudores = 0;
            }
            
            // Actualizar pasos din√°micamente
            actualizarPasosDinamicos();
        }

        function addMoreCodeudor(hasMore, currentNum) {
            // Limpiar selecci√≥n anterior
            document.getElementById(`btnMoreCodeudor${currentNum}No`).classList.remove('selected');
            document.getElementById(`btnMoreCodeudor${currentNum}Si`).classList.remove('selected');
            
            // Marcar bot√≥n actual
            event.target.classList.add('selected');
            
            if (hasMore && currentNum < 3) {
                // Agregar otro codeudor
                state.numCodeudores = currentNum + 1;
            } else {
                // No m√°s codeudores - limpiar posteriores si existen
                if (state.numCodeudores > currentNum) {
                    for (let i = currentNum + 1; i <= state.numCodeudores; i++) {
                        limpiarCodeudor(i);
                    }
                }
                state.numCodeudores = currentNum;
            }
            
            // Actualizar pasos
            actualizarPasosDinamicos();
        }

        // ==========================================
        // LIMPIEZA INTELIGENTE
        // ==========================================
        
        function limpiarCodeudor(num) {
            // Limpiar archivos
            delete state.archivosBase64[`docCodeudor${num}`];
            
            // Limpiar campos del formulario
            const container = document.getElementById(`codeudor${num}Fields`);
            if (container) {
                container.innerHTML = '';
            }
            
            // Limpiar datos guardados
            delete state.codeudorDataSaved[num];
            
            // Limpiar botones de decisi√≥n
            const btnNo = document.getElementById(`btnMoreCodeudor${num}No`);
            const btnSi = document.getElementById(`btnMoreCodeudor${num}Si`);
            if (btnNo) btnNo.classList.remove('selected');
            if (btnSi) btnSi.classList.remove('selected');
            
            console.log(`üßπ Codeudor ${num} limpiado`);
        }

        function limpiarTodosCodeudores() {
            for (let i = 1; i <= 3; i++) {
                limpiarCodeudor(i);
            }
            state.numCodeudores = 0;
            state.codeudorDataSaved = {};
            console.log('üßπ Todos los codeudores limpiados');
        }

        // ==========================================
        // VALIDACI√ìN DE PASOS
        // ==========================================
        
        function validateCurrentStep() {
            const currentStepData = state.steps[state.currentStep - 1];
            
            switch(currentStepData.id) {
                case 'documentos':
                    return validateStep1();
                case 'informacion':
                    return validateStep2();
                case 'identidad':
                    return validateStep3();
                case 'codeudor-1':
                case 'codeudor-2':
                case 'codeudor-3':
                    const num = parseInt(currentStepData.id.split('-')[1]);
                    return validateCodeudor(num);
                default:
                    return true;
            }
        }

        function validateStep1() {
            if (!state.archivosBase64.estudioAprobado) {
                showError('Por favor cargue el documento de estudio aprobado');
                return false;
            }
            if (!state.archivosBase64.comprobantePago) {
                showError('Por favor cargue el comprobante de pago');
                return false;
            }
            return true;
        }

        function validateStep2() {
            const campos = [
                'tipoDocumento', 'numeroDocumento', 'confirmarDocumento',
                'nombres', 'apellidos', 'email', 'confirmarEmail',
                'celular', 'confirmarCelular', 'ocupacion'
            ];
            
            for (const campo of campos) {
                const elemento = document.getElementById(campo);
                if (!elemento || !elemento.value.trim()) {
                    showError(`Por favor complete: ${campo}`);
                    elemento?.focus();
                    return false;
                }
            }
            
            // Validar coincidencias
            if (document.getElementById('numeroDocumento').value !== 
                document.getElementById('confirmarDocumento').value) {
                showError('Los n√∫meros de documento no coinciden');
                return false;
            }
            
            if (document.getElementById('email').value !== 
                document.getElementById('confirmarEmail').value) {
                showError('Los correos no coinciden');
                return false;
            }
            
            if (document.getElementById('celular').value !== 
                document.getElementById('confirmarCelular').value) {
                showError('Los n√∫meros de celular no coinciden');
                return false;
            }
            
            return true;
        }

        function validateStep3() {
            if (state.documentoCompletoRequerido === null) {
                showError('Por favor indique si el archivo tiene ambas caras');
                return false;
            }
            
            // Validar archivos seg√∫n tipo
            if (state.documentoCompletoRequerido) {
                if (!state.archivosBase64.docIdentidad) {
                    showError('Debe cargar el documento de identidad');
                    return false;
                }
            } else {
                if (!state.archivosBase64.docIdentidadFrente || 
                    !state.archivosBase64.docIdentidadReverso) {
                    showError('Debe cargar ambas caras del documento');
                    return false;
                }
            }
            
            if (state.hasCodeudores === null) {
                showError('Por favor indique si tiene codeudores');
                return false;
            }
            
            return true;
        }

        function validateCodeudor(num) {
            // Guardar datos antes de validar
            guardarDatosCodeudor(num);
            
            const campos = [
                `tipoDocCodeudor${num}`,
                `numDocCodeudor${num}`,
                `nombresCodeudor${num}`,
                `apellidosCodeudor${num}`,
                `emailCodeudor${num}`,
                `celularCodeudor${num}`
            ];
            
            for (const campo of campos) {
                const elemento = document.getElementById(campo);
                if (!elemento || !elemento.value.trim()) {
                    showError(`Por favor complete todos los campos del codeudor ${num}`);
                    elemento?.focus();
                    return false;
                }
            }
            
            if (!state.archivosBase64[`docCodeudor${num}`]) {
                showError(`Debe cargar el documento del codeudor ${num}`);
                return false;
            }
            
            return true;
        }

        function guardarDatosCodeudor(num) {
            const tipoDoc = document.getElementById(`tipoDocCodeudor${num}`);
            if (tipoDoc && tipoDoc.value) {
                state.codeudorDataSaved[num] = {
                    tipoDocumento: tipoDoc.value,
                    numeroDocumento: document.getElementById(`numDocCodeudor${num}`).value,
                    nombres: document.getElementById(`nombresCodeudor${num}`).value,
                    apellidos: document.getElementById(`apellidosCodeudor${num}`).value,
                    email: document.getElementById(`emailCodeudor${num}`).value,
                    celular: document.getElementById(`celularCodeudor${num}`).value
                };
            }
        }

        // ==========================================
        // CREACI√ìN DE CAMPOS DE CODEUDOR
        // ==========================================
        
        function createCodeudorFields(num) {
            const container = document.getElementById(`codeudor${num}Fields`);
            if (!container) return;
            
            // Si ya hay datos guardados, restaurarlos
            const savedData = state.codeudorDataSaved[num] || {};
            
            container.innerHTML = `
                <div class="form-field show">
                    <div class="form-row">
                        <div>
                            <label>Tipo de Documento <span class="required">*</span></label>
                            <select id="tipoDocCodeudor${num}" required>
                                <option value="">Seleccione...</option>
                                <option value="CC" ${savedData.tipoDocumento === 'CC' ? 'selected' : ''}>C√©dula de Ciudadan√≠a</option>
                                <option value="CE" ${savedData.tipoDocumento === 'CE' ? 'selected' : ''}>C√©dula de Extranjer√≠a</option>
                                <option value="PA" ${savedData.tipoDocumento === 'PA' ? 'selected' : ''}>Pasaporte</option>
                            </select>
                        </div>
                        
                        <div>
                            <label>N√∫mero de Documento <span class="required">*</span></label>
                            <input type="text" id="numDocCodeudor${num}" 
                                   value="${savedData.numeroDocumento || ''}" 
                                   placeholder="N√∫mero de documento" required>
                        </div>
                    </div>
                </div>
                
                <div class="form-field show">
                    <div class="form-row">
                        <div>
                            <label>Nombres <span class="required">*</span></label>
                            <input type="text" id="nombresCodeudor${num}" 
                                   value="${savedData.nombres || ''}"
                                   placeholder="Nombres completos" required>
                        </div>
                        
                        <div>
                            <label>Apellidos <span class="required">*</span></label>
                            <input type="text" id="apellidosCodeudor${num}" 
                                   value="${savedData.apellidos || ''}"
                                   placeholder="Apellidos completos" required>
                        </div>
                    </div>
                </div>
                
                <div class="form-field show">
                    <div class="form-row">
                        <div>
                            <label>Email <span class="required">*</span></label>
                            <input type="email" id="emailCodeudor${num}" 
                                   value="${savedData.email || ''}"
                                   placeholder="correo@ejemplo.com" required 
                                   onblur="validarEmail(this)">
                        </div>
                        
                        <div>
                            <label>Celular <span class="required">*</span></label>
                            <input type="tel" id="celularCodeudor${num}" 
                                   value="${savedData.celular || ''}"
                                   placeholder="3001234567" required 
                                   onblur="validarTelefono(this)">
                        </div>
                    </div>
                </div>
                
                <div class="form-field show">
                    <label>Documento de Identidad <span class="required">*</span></label>
                    <div class="file-upload-wrapper">
                        <label class="file-upload-label" for="docCodeudor${num}" id="labelDocCodeudor${num}">
                            ${state.archivosBase64[`docCodeudor${num}`] ? 
                              'Archivo cargado ‚úì' : 'Seleccionar archivo - Ambas caras'}
                        </label>
                        <input type="file" id="docCodeudor${num}" class="file-upload-input" 
                               accept="image/*,.pdf" required 
                               onchange="handleCodeudorFile(this, ${num})">
                    </div>
                    <div class="file-size-info">M√°ximo 10MB - Formatos: JPG, PNG, PDF</div>
                </div>
            `;
        }

        // ==========================================
        // FUNCIONES AUXILIARES
        // ==========================================
        
        function iniciarRegistro() {
            document.getElementById('initialScreen').classList.add('hidden');
            document.getElementById('progressContainer').classList.add('show');
            document.getElementById('formContent').classList.add('show');
            document.getElementById('formNavigation').classList.add('show');
            
            // Renderizar barra de progreso inicial
            actualizarPasosDinamicos();
            
            // Mostrar primer campo
            setTimeout(() => {
                document.getElementById('field1')?.classList.add('show');
            }, 100);
        }

        function validarCodigoRegistro(codigo) {
            const regex = /^[A-Z0-9_\-()#\s]+$/;
            return regex.test(codigo);
        }

        function validarEmail(input) {
            const email = input.value.trim();
            const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            
            if (!regex.test(email)) {
                input.classList.add('invalid');
                input.classList.remove('valid');
                return false;
            }
            
            input.classList.add('valid');
            input.classList.remove('invalid');
            return true;
        }

        function validarTelefono(input) {
            const telefono = input.value.trim();
            const regex = /^[0-9]{10}$/;
            
            if (!regex.test(telefono)) {
                input.classList.add('invalid');
                input.classList.remove('valid');
                return false;
            }
            
            input.classList.add('valid');
            input.classList.remove('invalid');
            return true;
        }

        function showError(message) {
            alert(message);
        }

        function handleFileSelect(input, nextFieldId) {
            const file = input.files[0];
            if (!file) return;
            
            if (file.size > state.maxFileSize) {
                alert(`El archivo es demasiado grande. M√°ximo ${state.maxFileSize / 1024 / 1024}MB`);
                input.value = '';
                return;
            }
            
            const label = document.getElementById('label' + input.id.charAt(0).toUpperCase() + input.id.slice(1));
            if (label) {
                label.textContent = file.name;
                label.classList.add('file-selected');
            }
            
            convertirArchivoBase64(input, () => {
                if (nextFieldId) {
                    setTimeout(() => {
                        document.getElementById(nextFieldId)?.classList.add('show');
                    }, 300);
                }
            });
        }

        function convertirArchivoBase64(input, callback) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                state.archivosBase64[input.id] = {
                    nombre: file.name,
                    tipo: file.type,
                    contenido: e.target.result
                };
                
                if (callback) callback();
            };
            
            reader.readAsDataURL(file);
        }

        function handleDocumentUpload(input, tipo) {
            const file = input.files[0];
            if (!file) return;
            
            const labelId = 'labelDocIdentidad' + tipo.charAt(0).toUpperCase() + tipo.slice(1);
            const label = document.getElementById(labelId);
            if (label) {
                label.textContent = file.name;
                label.classList.add('file-selected');
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                if (tipo === 'completo') {
                    state.archivosBase64.docIdentidad = {
                        nombre: file.name,
                        tipo: file.type,
                        contenido: e.target.result
                    };
                    state.documentosIdentidadCargados = true;
                } else if (tipo === 'frente') {
                    state.archivosBase64.docIdentidadFrente = {
                        nombre: file.name,
                        tipo: file.type,
                        contenido: e.target.result
                    };
                    if (state.archivosBase64.docIdentidadReverso) {
                        state.documentosIdentidadCargados = true;
                    }
                } else if (tipo === 'reverso') {
                    state.archivosBase64.docIdentidadReverso = {
                        nombre: file.name,
                        tipo: file.type,
                        contenido: e.target.result
                    };
                    if (state.archivosBase64.docIdentidadFrente) {
                        state.documentosIdentidadCargados = true;
                    }
                }
                
                // Habilitar pregunta de codeudores
                if (state.documentosIdentidadCargados) {
                    document.getElementById('codeudorQuestion').classList.remove('disabled');
                    document.getElementById('btnCodeudorNo').disabled = false;
                    document.getElementById('btnCodeudorSi').disabled = false;
                }
            };
            reader.readAsDataURL(file);
        }

        function handleCodeudorFile(input, index) {
            const file = input.files[0];
            if (!file) return;
            
            if (file.size > state.maxFileSize) {
                alert(`Archivo muy grande. M√°ximo ${state.maxFileSize / 1024 / 1024}MB`);
                input.value = '';
                return;
            }
            
            const label = document.getElementById(`labelDocCodeudor${index}`);
            if (label) {
                label.textContent = file.name;
                label.classList.add('file-selected');
            }
            
            convertirArchivoBase64(input);
        }

        function showNextField(fieldId) {
            const field = document.getElementById(fieldId);
            if (field && !field.classList.contains('show')) {
                setTimeout(() => {
                    field.classList.add('show');
                }, 300);
            }
        }

        function validateAndShow(field1Id, field2Id, nextFieldId) {
            const val1 = document.getElementById(field1Id).value;
            const val2 = document.getElementById(field2Id).value;
            
            if (val1 === val2 && val1 !== '') {
                showNextField(nextFieldId);
            } else if (val1 !== val2 && val2 !== '') {
                alert('Los valores no coinciden');
            }
        }

        function setupValidationListeners() {
            // Validaci√≥n en tiempo real
            const emailInput = document.getElementById('email');
            const celularInput = document.getElementById('celular');
            
            if (emailInput) {
                emailInput.addEventListener('input', function() {
                    if (this.value.length > 5) validarEmail(this);
                });
            }
            
            if (celularInput) {
                celularInput.addEventListener('input', function() {
                    if (this.value.length >= 10) validarTelefono(this);
                });
            }
        }

        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 50;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 15 + 's';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // Stubs de funciones para modales (implementaci√≥n igual que antes)
        function mostrarModalPago() { /* Implementaci√≥n sin cambios */ }
        function cerrarModalPago() { /* Implementaci√≥n sin cambios */ }
        function copiarNumero() { /* Implementaci√≥n sin cambios */ }
        function mostrarConfirmacion() { /* Implementaci√≥n sin cambios */ }
        function cerrarConfirmacion() { /* Implementaci√≥n sin cambios */ }
        function setupSlider() { /* Implementaci√≥n sin cambios */ }
        function enviarFormulario() { /* Implementaci√≥n sin cambios */ }

        // Log de sistema
        console.info('üöÄ EFirmaContrata Wizard v4.0');
        console.info('‚úÖ Sin expansiones - Navegaci√≥n pura');
        console.info('‚úÖ Barra din√°mica adaptativa');
        console.info('‚úÖ Limpieza inteligente de pasos');
    </script>
</body>
</html>
